---
title: "Pre_XueYang"
author: "Xue Yang"
date: "4/4/2019"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(tidyverse)
library(haven)
```


# Demographics variables


Age in years at screening: variable name RIDAGEYR
Gender: variable name RIAGENDR
Marital status: variable name DMDMARTL
Race/ethinicity: Race/Hispanic origin w/ NH Asian, variable name RIDRETH3
Citizenship status: variable name DMDCITZN
Education level: Education level - Adults 20+, variable name DMDEDUC2


sequence number, hispanic ethnicity, age,Ttotal household income

https://wwwn.cdc.gov/nchs/nhanes/search/variablelist.aspx?Component=Demographics&CycleBeginYear=2015


```{r demo}
demographics = read_xpt("data/demographics.XPT") %>% 
  janitor::clean_names() %>%
  select(seqn, ridageyr, riagendr, dmdmartl, ridreth3, dmdcitzn, dmdeduc2) %>% 
  filter(ridageyr > 20)
```

# Income

Family monthly poverty level category, variable name: INDFMMPCSAS
https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/INQ_I.htm#INDFMMPI 

demographics = read_xpt("data/demographics.XPT") %>% janitor::clean_names()
1	Monthly poverty level index <= 1.30;2	1.30 < Monthly poverty level index <= 1.85;3	Monthly poverty level index > 1.85

```{r income}
income = read_xpt("data/income.XPT") %>% 
  janitor::clean_names() %>% 
  select(seqn, income = indfmmpc) %>% 
  mutate(income = ifelse(income %in% c(1,2,3), income, NA))
```

#  Depression score
sum of scores for 9 items. Each item is scored as 0 (not at all) to 3 (nearly every day), which assesses the frequency of depression related symptoms.
extracted from dataset Mental Health - Depression Screener  

```{r depression}
depression = read_xpt("data/mental_health.XPT") %>% 
  janitor::clean_names()
seqn = depression$seqn
depression_subset = depression %>% select(-seqn)
depression = map_dfc(depression_subset, ~ifelse(.x %in% c(0,1,2,3), .x, NA)) %>% 
  mutate(depression_score = round(rowMeans(., na.rm = TRUE), 3)) %>% 
  add_column(seqn) %>% 
  select(seqn, depression_score)
```

#smoking
smoked at least 100 cigarettes in life

```{r}

smoking = read_xpt("data/smoking.xpt") %>% janitor::clean_names() %>%
  select(seqn, smoked = smq020) %>%
  mutate(smoked = ifelse(!(smoked %in% c(1,2)), NA, smoked))

```


#blood pressure and cholesterol
ever told you have high blood pressure, doctor ever told you have high cholesterol

https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/BPQ_I.htm

```{r}

bp_chol = read_xpt("data/BPQ_I.xpt") %>% janitor::clean_names() %>%
  select(seqn, highbp = bpq020, highchol = bpq080) %>%
  mutate(highbp = ifelse(highbp == 9, NA, highbp),
         highchol = ifelse(! (highchol %in% c(1,2)), NA, highchol))

```

#alcohol

had at least 12 drinks of alcohol/1 year (ever a moderate drinker), ever had 4/5 drinks every day

```{r}

alcohol = read_xpt("data/alcohol.xpt") %>% janitor::clean_names() %>%
  select(seqn,drinker = alq101, heavy_drinker = alq151 ) %>%
  mutate(heavy_drinker = ifelse(!(heavy_drinker %in% c(1,2)), NA, heavy_drinker),
         drinker = ifelse(!(drinker %in% c(1,2)), NA, drinker))

```






# Diet Behavior and Nutrition

```{r}
lookup.xport("data/diet.xpt")

diet_behavior =
  read_xpt("data/diet.xpt") %>% 
  select(seqn = SEQN, 
         fast = DBD900, 
         ready = DBD905, 
         forzen = DBD910) %>% 
  filter(!fast %in% c(5555, 7777, 9999),
         !ready %in% c(6666, 7777, 9999),
         !forzen %in% c(6666, 7777, 9999))


# proportion of missing value
sum(is.na(diet_behavior$fast))/length(diet_behavior$seqn)
sum(is.na(diet_behavior$ready))/length(diet_behavior$seqn)
sum(is.na(diet_behavior$forzen))/length(diet_behavior$seqn)
```

```{r}
lookup.xport("data/diet_2014.xpt")

diet_behavior_2014 =
  read_xpt("data/diet_2014.xpt") %>% 
  select(seqn = SEQN, 
         fast = DBD900, 
         ready = DBD905, 
         forzen = DBD910) %>% 
  filter(!fast %in% c(5555, 7777, 9999),
         !ready %in% c(6666, 7777, 9999),
         !forzen %in% c(6666, 7777, 9999))


diet_behavior_all = rbind(diet_behavior_2014, diet_behavior)
```


# Body Measure

```{r}
body_measures = 
  read_xpt("data/body_measures.xpt") %>% 
  select(seqn = SEQN, 
         bmi = BMXBMI)

# proportion of missing value
sum(is.na(body_measures$bmi))/length(body_measures$seqn)
```

```{r}
body_measures_2014 = 
  read_xpt("data/body_measures_2014.xpt") %>% 
  select(seqn = SEQN, 
         bmi = BMXBMI)

body_measures_all = rbind(body_measures_2014, body_measures)
```

# Diabetes

```{r}
lookup.xport("data/diabetes.xpt")

diabetes =
  read_xpt("data/diabetes.xpt") %>% 
  select(seqn = SEQN, 
         diabete = DIQ010) %>% 
  mutate(diabete = ifelse(!(diabete %in% c(1,2,3)), NA, diabete))

# proportion of missing value
sum(is.na(diabetes$diabete))/length(diabetes$seqn)
```

```{r}
diabetes_2014 =
  read_xpt("data/diabetes_2014.xpt") %>% 
  select(seqn = SEQN, 
         diabete = DIQ010) %>% 
  mutate(diabete = ifelse(!(diabete %in% c(1,2,3)), NA, diabete))

diabetes_all = rbind(diabetes_2014, diabetes)
```

# Medical Conditions

```{r}
lookup.xport("data/medical_cond.xpt")

medical_cond =
  read_xpt("data/medical_cond.xpt") %>% 
  select(seqn = SEQN, 
         overweight = MCQ080, 
         gout = MCQ160N) %>% 
  mutate(overweight = ifelse(!(overweight %in% c(1,2)), NA, overweight),
         gout = ifelse(!(gout %in% c(1,2)), NA, gout))


# proportion of missing value
sum(is.na(medical_cond$overweight))/length(medical_cond$seqn)
sum(is.na(medical_cond$gout))/length(medical_cond$seqn)
```

```{r}
medical_cond_2014 =
  read_xpt("data/medical_cond_2014.xpt") %>% 
  select(seqn = SEQN, 
         overweight = MCQ080, 
         gout = MCQ160N) %>% 
  mutate(overweight = ifelse(!(overweight %in% c(1,2)), NA, overweight),
         gout = ifelse(!(gout %in% c(1,2)), NA, gout))

medical_cond_all = rbind(medical_cond_2014, medical_cond)
```

# Response

```{r}
coronary = 
  read_xpt("data/medical_cond.xpt") %>% 
  select(seqn = SEQN, 
         disease = MCQ160C) %>% 
  mutate(disease = ifelse(!(disease %in% c(1,2)), NA, disease))

# proportion of missing value
sum(is.na(coronary$disease))/length(coronary$seqn)
```

```{r}
coronary_2014 = 
  read_xpt("data/medical_cond_2014.xpt") %>% 
  select(seqn = SEQN, 
         disease = MCQ160C) %>% 
  mutate(disease = ifelse(!(disease %in% c(1,2)), NA, disease))

coronary_all = rbind(coronary_2014, coronary)
```


#variables we might need to remove: fast food (27.7%), heavy drinker(but this is important one)


```{r}

merged_x_df = demographics %>%
  left_join(income) %>%
  left_join(depression) %>%
  left_join(diabetes) %>%
  left_join(smoking) %>%
  left_join(diet_behavior) %>%
  left_join(alcohol) %>%
  left_join(medical_cond)

full_data = coronary %>%
  inner_join(merged_x_df) %>%
  filter(!is.na(disease))

summary(full_data)

full_data_no_missing = na.omit(full_data)

full_data1 = coronary %>%
  inner_join(merged_x_df) %>%
  filter(!is.na(disease)) %>% 
  filter(!is.na(heavy_drinker)) %>% 
  filter(!is.na(fast))
summary(full_data1)
dim(full_data1)
```

